{% extends "base.html" %}

{% block content %}
<div class="bg-gray-900 mt-4 flex items-center justify-center">
    <div class="w-full max-w-md bg-gray-800 shadow-md rounded-lg overflow-hidden">
        <div class="px-8 py-6">
            <h2 class="text-2xl font-bold text-gray-100 mb-4 text-center">{{ report.title }}</h2>
            <p class="text-gray-300 mb-4">{{ report.content }}</p>
            <p class="text-gray-300 mb-4">Resolution Method: {{ report.get_resolution_method_display }}</p>
            <p class="text-gray-300 mb-4">Status:
                {% if is_admin %}
                <form method="post" action="{% url 'communities:edit_report' community.id report.id %}">
                    {% csrf_token %}
                    <select name="status" class="py-2 px-3 text-gray-300 block w-full bg-gray-700 border-gray-600 rounded-md focus:border-indigo-500 focus:ring focus:ring-indigo-500 focus:ring-opacity-50">
                        {% for status in report.Status.choices %}
                        <option value="{{ status.0 }}" {% if report.status == status.0 %}selected{% endif %}>{{ status.1 }}</option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="w-full border text-gray-100 font-bold py-2 px-4 rounded hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50 transition duration-150 ease-in-out mt-4">Update</button>
                </form>
                {% else %}
                {{ report.get_status_display }}
                {% endif %}
            </p>
            {% if report.author %}
            <p class="text-gray-300 mb-4">Submitted by: {{ report.author }} ({{ report.author.email }})</p>
            {% else %}
            <p class="text-gray-300 mb-4">Submitted Anonymously</p>
            {% endif %}
            <p class="text-gray-300 mb-4">Created at: {{ report.created_at }}</p>
            <p class="text-gray-300 mb-4">Updated at: {{ report.updated_at }}</p>
            <hr class="my-4 border-gray-600">
            <h6 class="text-lg font-semibold text-gray-100 mb-2">Media Files:</h6>
            {% if media %}
            <ul class="list-group">
                {% for media_file in media %}
                <li class="list-group-item bg-gray-700 text-gray-300 mb-2 rounded-md">
                    <a href="{{ media_file.file.url }}" target="_blank" class="text-indigo-500 hover:text-indigo-400">{{ media_file.file.name }}</a>
                </li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="text-gray-300">No media files attached to this report.</p>
            {% endif %}
            <hr class="my-4 border-gray-600">
            <div class="btn-group flex justify-between" role="group" aria-label="Report Options">
                <a href="{% url 'communities:dashboard' community.id %}" class="w-full border text-gray-100 font-bold py-2 px-4 rounded hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50 transition duration-150 ease-in-out mr-2">Back to Community</a>
                {% if is_admin %}
                <button type="button" class="w-full border text-gray-100 font-bold py-2 px-4 rounded hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50 transition duration-150 ease-in-out ml-2 mr-2">Reply to Report</button>
                <a href="{% url 'communities:delete_report' community.id report.id %}" class="w-full border text-gray-100 font-bold py-2 px-4 rounded hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-opacity-50 transition duration-150 ease-in-out ml-2">Close Report</a>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="w-full max-w-md bg-gray-800 shadow-md rounded-lg overflow-hidden mt-4">
        <div class="px-8 py-6">
            <h5 class="text-2xl font-bold text-gray-100 mb-4 text-center">Response</h5>
            {% if is_admin %}
            <div class="mt-5">
                <h6 class="text-lg font-semibold text-gray-100 mb-2">Notes:</h6>
                <form method="post" action="{% url 'communities:edit_report' community.id report.id %}" class="mt-2">
                    {% csrf_token %}
                    <textarea name="notes" class="w-full h-40 border border-gray-600 rounded-md px-4 py-2 resize-none bg-gray-700 text-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50" placeholder="Enter notes here...">{{ report.notes }}</textarea>
                    <button type="submit" class="mt-3 bg-indigo-500 text-white px-4 py-2 rounded-md hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Save</button>
                </form>
            </div>
            {% else %}
            <div class="mt-5">
                <h6 class="text-lg font-semibold text-gray-100 mb-2">Notes:</h6>
                <p class="text-gray-300">{{ report.notes }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}